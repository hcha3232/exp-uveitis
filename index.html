<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MCQDTPWJ');</script>
    <!-- End Google Tag Manager -->
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="description" content="Uveitis Diagnostic Tree" />
    <meta name="theme-color" content="#fbf8f8" />
    <title>Uveitis Diagnostic Tree</title>
    <link rel="stylesheet" href="/css/style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="manifest" href="/manifest.json" />


    <link rel="icon" type="image/png" sizes="196x196" href="/output/favicon-196.png">
    <link rel="apple-touch-icon" href="/output/apple-icon-180.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="apple-touch-startup-image" href="/output/apple-splash-2048-2732.jpg" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="/output/apple-splash-2732-2048.jpg" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="/output/apple-splash-1668-2388.jpg" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="/output/apple-splash-2388-1668.jpg" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="/output/apple-splash-1536-2048.jpg" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="/output/apple-splash-2048-1536.jpg" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="/output/apple-splash-1668-2224.jpg" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="/output/apple-splash-2224-1668.jpg" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="/output/apple-splash-1620-2160.jpg" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="/output/apple-splash-2160-1620.jpg" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="/output/apple-splash-1290-2796.jpg" media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="/output/apple-splash-2796-1290.jpg" media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="/output/apple-splash-1179-2556.jpg" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="/output/apple-splash-2556-1179.jpg" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="/output/apple-splash-1284-2778.jpg" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="/output/apple-splash-2778-1284.jpg" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="/output/apple-splash-1170-2532.jpg" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="/output/apple-splash-2532-1170.jpg" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="/output/apple-splash-1125-2436.jpg" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="/output/apple-splash-2436-1125.jpg" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="/output/apple-splash-1242-2688.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="/output/apple-splash-2688-1242.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="/output/apple-splash-828-1792.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="/output/apple-splash-1792-828.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="/output/apple-splash-1242-2208.jpg" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="/output/apple-splash-2208-1242.jpg" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="/output/apple-splash-750-1334.jpg" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="/output/apple-splash-1334-750.jpg" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="/output/apple-splash-640-1136.jpg" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="/output/apple-splash-1136-640.jpg" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)">
</head>
<body style="background-color: #fbf8f8;">
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MCQDTPWJ"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <nav id="nav"> </nav>
    <div style="padding-top: 5rem;"></div>

    <div class="container" style="padding: 10px 0; display:flex; flex-direction: column; align-items: center; gap: 10px;">
        <div class="card shadow-sm" style="width: 18rem;">
            <img src="/img/auHom.webp" class="card-img-top home-icon" alt="...">
            <div class="card-body">
            <h5 class="card-title" style="text-align: center">Anterior uveitis</h5>
            <p class="card-text"></p>
            <a href="/html/au-exp.html" class="btn btn-outline-primary" style="width:100%;">Start diagnosis</a>
            </div>
        </div>
        <div class="card shadow-sm" style="width: 18rem;">
            <img src="/img/iuHom.webp" class="card-img-top home-icon" alt="...">
            <div class="card-body">
            <h5 class="card-title" style="text-align: center">Intermediate uveitis</h5>    
            <p class="card-text"></p>
            <a href="/html/iu-exp.html" class="btn btn-outline-primary" style="width:100%;">Start diagnosis</a>
            </div>
        </div>
        <div class="card shadow-sm" style="width: 18rem;">
            <img src="img/puHom.webp"  class="card-img-top home-icon" alt="...">
            <div class="card-body">
            <h5 class="card-title" style="text-align: center">Posterior uveitis and Panuveitis</h5>
            <p class="card-text"></p>
            <a href="/html/pu-exp.html" class="btn btn-outline-primary" style="width:100%;">Start diagnosis</a>
            </div>
        </div>
    </div>

    <div style="min-height: 100px"></div>
    
    <nav id="nav-footer" style="box-shadow: rgba(0, 0, 0, 0.35) 0px 5px 15px;"> </nav>
    <script src="/scripts/nav.js"></script>
    
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-auth.js";
        import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-database.js";
    
        // Your web app's Firebase configuration
        const firebaseConfig = {
                apiKey: "AIzaSyCzOmDJUdo4Zb6JdqyV4Z9wJAR-oNN3KPU",
                authDomain: "uveitistree.firebaseapp.com",
                projectId: "uveitistree",
                storageBucket: "uveitistree.appspot.com",
                messagingSenderId: "10694666072",
                appId: "1:10694666072:web:061c2e6f94e29361a0672d",
                databaseURL: "https://uveitistree-default-rtdb.asia-southeast1.firebasedatabase.app"
            };
    
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app)

        // Hard-coded credentials
        const knownEmail = "uveitisproject@gmail.com";  // Replace with your known email
        const knownPassword = "password";     // Replace with your known password

        const signInWithHardCodedCredentials = () => {
            signInWithEmailAndPassword(auth, knownEmail, knownPassword)
                .then((userCredential) => {
                    // Signed in 
                    const user = userCredential.user;
                    console.log("User signed in as:", user.email);
                })
                .catch((error) => {
                    console.error("Error signing in:", error.message);
                });
        }
    
        // Check if a user is signed in
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // User is signed in, you can access user data here
                console.log("User is signed in:");
                // Retrieve researchID from realtime db
                const userRef = ref(db, 'users/' + user.uid)
                get(userRef).then((snapshot) => {
                    if (snapshot.exists()) {
                        const researchID = snapshot.val().researchID;

                        localStorage.setItem('researchID', researchID);

                        // Push to dataLayer
                        window.dataLayer = window.dataLayer || [];
                        window.dataLayer.push({
                            'event': 'userLogin',
                            'userID': researchID
                        });
                    }
                });
            }
            else {
                // No user is signed in, attempt to log in with hard-coded credentials
                console.log("No user is signed in, attempting to log in with hard-coded credentials");
                signInWithHardCodedCredentials();
            } 
            
            /*else {
                // No user is signed in, redirect to login page or handle as desired
                console.log("No user is signed in");
                // Example: redirect to login page
                window.location.href = '/login.html';
            }*/
        });

        const LogOutBtn = document.getElementById('signOutBtn')
        LogOutBtn.addEventListener('click', ()=> {
            signOut(auth).then(() => {
                // Sign-out successful.
                window.location.href = '/login.html';
            }).catch((error) => {
                // An error happened.
            });
        })
        
    </script>
    
    <script>
        let homeIcon = document.getElementById('home-icon');
        homeIcon.style.color = '#000';
        homeIcon.style.borderTop = '2px solid black';
    </script>
    <script>
        
    </script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.7/dist/umd/popper.min.js" integrity="sha384-zYPOMqeu1DAVkHiLqWBUTcbYfZ8osu1Nd6Z89ify25QV9guujx43ITvfi12/QExE" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.min.js" integrity="sha384-Y4oOpwW3duJdCWv5ly8SCFYWqFDsfob/3GkgExXKV4idmbt98QcxXYs9UoXAB7BZ" crossorigin="anonymous"></script>
    
    <script>
        if ("serviceWorker" in navigator) {
            window.addEventListener("load", () => {
                navigator.serviceWorker.register("/serviceworker.js")
                    .then(reg => {
                        console.log("Service Worker Registered:", reg);

                        // Detect when a new SW is installed
                        reg.onupdatefound = () => {
                            const newWorker = reg.installing;
                            if (newWorker) {
                                newWorker.onstatechange = () => {
                                    if (newWorker.state === "installed" && navigator.serviceWorker.controller) {
                                        console.log("New Service Worker installed. Reloading...");
                                        // Ensure the new service worker takes control immediately
                                        newWorker.postMessage({ action: 'skipWaiting' });
                                        window.location.reload(); // Auto-reload to apply the update
                                    }
                                };
                            }
                        };
                   
                    })
                    .catch(err => {
                        console.log("Service Worker Registration Failed:", err);
                    });
            
            })
        };
        

        function shouldUnregister(registration) {
            // Example condition: You could check the SW version or some other custom condition
            // For simplicity, let's say we always unregister old ones, but you can change this logic
            return true;  // Unregister old SWs for now, but adjust this condition if needed
        }

    </script>

    
</body>

</html>